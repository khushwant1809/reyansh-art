---
interface Props {
  title: string;
  description?: string;
}

const { title, description = "Art and paintings by Reyansh" } = Astro.props;
const base = import.meta.env.BASE_URL ?? '/';
---
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <link rel="icon" type="image/svg+xml" href={`${base}favicon.svg`} />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=DM+Sans:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet" />
    <title>{title}</title>
  </head>
  <body>
    <header class="site-header">
      <div class="header-inner">
        <a href={base} class="logo">Reyansh</a>
        <span class="tagline">Art Portfolio</span>
        <nav class="site-nav" aria-label="Main">
          <a href={base} class="nav-link">Portfolio</a>
          <a href={`${base}timeline`} class="nav-link">Timeline</a>
          <a href={`${base}feedback`} class="nav-link">Feedback</a>
        </nav>
      </div>
    </header>
    <main class="main">
      <slot />
    </main>
    <footer class="site-footer">
      <p>Reyansh Shah Â· Art portfolio Â· 4th grader Â· Drawing, Roblox, Minecraft, Swimming, Taekwondo, Music</p>
    </footer>
    <div id="lightbox" class="lightbox" aria-hidden="true">
      <button id="lightbox-close" type="button" aria-label="Close">Close</button>
      <button type="button" class="lightbox-nav lightbox-prev" id="lightbox-prev" aria-label="Previous">â€¹</button>
      <button type="button" class="lightbox-nav lightbox-next" id="lightbox-next" aria-label="Next">â€º</button>
      <div class="lightbox-content">
        <img id="lightbox-img" src="" alt="" />
        <div class="lightbox-caption">
          <h3 id="lightbox-title"></h3>
          <span id="lightbox-date" class="date"></span>
          <p id="lightbox-description" class="lightbox-description"></p>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightbox-img');
        const lightboxTitle = document.getElementById('lightbox-title');
        const lightboxDate = document.getElementById('lightbox-date');
        const lightboxDescription = document.getElementById('lightbox-description');
        const closeBtn = document.getElementById('lightbox-close');
        const prevBtn = document.getElementById('lightbox-prev');
        const nextBtn = document.getElementById('lightbox-next');

        const links = Array.from(document.querySelectorAll('[data-lightbox]'));
        let currentIndex = 0;

        function getItemData(el) {
          const img = el.querySelector('img');
          return {
            src: img ? (img.src.replace(/\/_\w+\//, '/').replace(/\?\w+/, '') || img.dataset.full || img.src) : '',
            alt: img ? img.alt : '',
            title: el.getAttribute('data-title') || '',
            date: el.getAttribute('data-date') || '',
            description: el.getAttribute('data-description') || ''
          };
        }

        function showItem(index) {
          if (index < 0) index = links.length - 1;
          if (index >= links.length) index = 0;
          currentIndex = index;
          const data = getItemData(links[currentIndex]);
          if (lightboxImg) lightboxImg.src = data.src;
          if (lightboxImg) lightboxImg.alt = data.alt;
          if (lightboxTitle) lightboxTitle.textContent = data.title;
          if (lightboxDate) lightboxDate.textContent = data.date;
          if (lightboxDescription) {
            lightboxDescription.textContent = data.description;
            lightboxDescription.style.display = data.description ? 'block' : 'none';
          }
        }

        document.querySelectorAll('[data-lightbox]').forEach((el, i) => {
          el.addEventListener('click', (e) => {
            e.preventDefault();
            currentIndex = i;
            showItem(currentIndex);
            if (lightbox) {
              lightbox.classList.add('open');
              document.body.style.overflow = 'hidden';
            }
          });
        });

        function closeLightbox() {
          if (lightbox) {
            lightbox.classList.remove('open');
            document.body.style.overflow = '';
          }
        }

        if (closeBtn) closeBtn.addEventListener('click', closeLightbox);
        if (prevBtn) prevBtn.addEventListener('click', (e) => { e.stopPropagation(); showItem(currentIndex - 1); });
        if (nextBtn) nextBtn.addEventListener('click', (e) => { e.stopPropagation(); showItem(currentIndex + 1); });
        if (lightbox) {
          lightbox.addEventListener('click', (e) => { if (e.target === lightbox) closeLightbox(); });
        }
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') closeLightbox();
          if (!lightbox || !lightbox.classList.contains('open')) return;
          if (e.key === 'ArrowLeft') { e.preventDefault(); showItem(currentIndex - 1); }
          if (e.key === 'ArrowRight') { e.preventDefault(); showItem(currentIndex + 1); }
        });

        const galleryItems = document.querySelectorAll('.gallery-item');
        if (galleryItems.length > 0) {
          const featuredIndex = Math.floor(Math.random() * galleryItems.length);
          galleryItems[featuredIndex].classList.add('featured');
        }

        let logoClicks = 0;
        const logo = document.querySelector('.logo');
        if (logo) {
          logo.addEventListener('click', (e) => {
            if (e.ctrlKey || e.metaKey) return;
            logoClicks++;
            if (logoClicks >= 5) {
              logoClicks = 0;
              logo.textContent = logo.textContent === 'Reyansh' ? 'ðŸŽ¨ Reyansh ðŸŽ¨' : 'Reyansh';
              setTimeout(() => { logo.textContent = 'Reyansh'; }, 1500);
            }
          });
        }
      });
    </script>
  </body>
</html>
